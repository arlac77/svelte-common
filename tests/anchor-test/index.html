<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf8" />
    <title>Anchor test</title>
  </head>
  <body>
    <svg width="400" height="400" viewBox="0 0 400 400">
      <rect
        id="anchor"
        fill="#ddd"
        x="80"
        y="10"
        width="100"
        height="30"
        stroke="blue"
        stroke-width="1"
        visibility="visible"
      />
      <rect
        id="content"
        fill="#ddd"
        x="10"
        y="100"
        width="120"
        height="200"
        stroke="green"
        stroke-width="1"
        visibility="visible"
      />
      <path
        id="path"
        stroke="red"
        fill="#eee7"
        stroke-width="1"
        visibility="visible"
      />
    </svg>
  </body>
  <script>
    const anchor = document.getElementById("anchor");
    const content = document.getElementById("content");
    const path = document.getElementById("path");

    function calc() {
      const anchorBB = anchor.getBBox();
      const contentBB = content.getBBox();

      path.setAttribute(
        "d",
        `M ${anchorBB.x} ${anchorBB.y}
       Q ${contentBB.x} ${anchorBB.y}
        ${contentBB.x} ${contentBB.y}
       v ${contentBB.height}
       Q ${contentBB.x} ${anchorBB.y + anchorBB.height}
        ${anchorBB.x} ${anchorBB.y + anchorBB.height}
       h ${anchorBB.width}
       v ${-anchorBB.height}
       z
      `
      );
    }

    calc();

    content.draggable = true;
    content.ondrag = () => {
        console.log("drag");
    };

    content.onclick = () => {
      const contentBB = content.getBBox();
      content.setAttribute("x", contentBB.x + 5);
      console.log(content);
      calc();
    };
  </script>
</html>
