<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf8" />
    <title>Anchor test</title>
    <style>
      body {
        position: relative;
      }
      button {
        position: absolute;
        top: 10px;
        left: 20px;
      }
      #menu {
        position: absolute;
        color: green;
        border-width: 1px;
        border-color: blue;
        padding: 0;
        margin: 0;
        max-width: 120px;
        top: 100px;
        left: 80px;
      }
      li {
        display: block;
      }
      svg {
        pointer-events: none;
      }
      svg:hover {
        stroke-width: 3;
      }
      svg path {
        stroke: red;
        fill: #eee7;
        pointer-events: auto;
      }
    </style>
  </head>
  <body>
    <button id="a">Anchor</button>
    <ul id="menu">
      <li>AAA</li>
      <li>BBB</li>
      <li>CCC</li>
      <li>DDD</li>
      <li>EEE</li>
      <li>FFF</li>
    </ul>

    <svg width="10000" height="10000">
      <path id="path" />
    </svg>
  </body>
  <script>
    const anchor = document.getElementById("a");
    const content = document.getElementById("menu");
    const path = document.getElementById("path");

    path.addEventListener("mouseleave", e => {
      content.style.stroke = "white";
      content.style.fill = "none";
    });

    const OFFSET = 9;

    function layoutPath() {
      const a = anchor.getBoundingClientRect();
      const c = content.getBoundingClientRect();
      a.x -= OFFSET;
      a.y -= OFFSET;
      c.x -= OFFSET;
      c.y -= OFFSET;

      let ax1, ax2, aw, ah, ay1, ay2, cx1;

      ax1 = a.x;
      aw = a.width;
      ah = a.height;
      ay1 = a.y;
      ay2 = a.y + a.height;
      cx1 = c.x;

      if (a.x + a.width > c.x + c.width) {
        ax1 = a.x + a.width;
        aw = -a.width;
        cx1 = c.x + c.width;
      }

      ax2 = ax1;

      if (a.y < c.y) {
        ax2 = a.x + a.width;
      }

      if (a.y + a.height > c.y + c.height) {
        ax1 = a.x + a.width;
        aw = 0;
      }

      path.setAttribute(
        "d",
        `M ${ax2} ${ay1}
       Q ${cx1} ${ay1}
        ${cx1} ${c.y}
       v ${c.height}
       Q ${cx1} ${ay2}
        ${ax1} ${ay2}
       h ${aw}
       v ${-ah}
       z`
      );
    }

    function makeDraggable(elem) {
      const bb = elem.getBoundingClientRect();
      elem.setAttribute("draggable", "true");

      let dx, dy;

      elem.ondragstart = event => {
        const rect = elem.getBoundingClientRect();
        dx = OFFSET + event.x - rect.x;
        dy = OFFSET + event.y - rect.y;
      };
      elem.ondrag = event => {
        elem.style.top = `${event.y - dy}px`;
        elem.style.left = `${event.x - dx}px`;
        layoutPath();
      };
    }

    makeDraggable(anchor);
    makeDraggable(content);

    layoutPath();
  </script>
</html>
