<!DOCTYPE html>
<html>
  <head>
    <meta charset="utf8" />
    <title>Anchor test</title>
    <style>
      #menu {
        color: green;
        border-width: 1px;
        border-color: blue;
        padding: 0;
        margin: 0;
        max-width: 120px;
      }
      li {
        display: block;
      }
      svg {
        position: absolute;
        left: 0;
        top: 0;
        z-index: -1;
        pointer-events: none;
      }
      svg:hover {
        stroke-width: 3;
      }
      svg path {
        stroke: red;
        fill: #eee7;
        pointer-events: auto;
      }
      svg rect {
        stroke: green;
        fill: #ddd;
        pointer-events: none;
      }
    </style>
  </head>
  <body>
    <button id="a">Anchor</button>
    <ul id="menu">
      <li>AAA</li>
      <li>BBB</li>
      <li>CCC</li>
      <li>DDD</li>
      <li>EEE</li>
      <li>FFF</li>
    </ul>

    <svg width="600" height="600">
      <rect id="anchor" />
      <rect id="content" />
      <path id="path" />
    </svg>
  </body>
  <script>
    const anchor = document.getElementById("anchor");
    const content = document.getElementById("content");
    const path = document.getElementById("path");
    
    path.addEventListener("mouseleave", e => {
      content.style.stroke = 'white';
      content.style.fill = 'none';
    });

    function calc() {
      const a = anchor.getBBox();
      const c = content.getBBox();

      let ax1, ax2, aw, ay1, ay2, cx1;

      ax1 = a.x;
      aw = a.width;
      ah = a.height;
      ay1 = a.y;
      ay2 = a.y + a.height;
      cx1 = c.x;

      if (a.x + a.width > c.x + c.width) {
        ax1 = a.x + a.width;
        aw = -a.width;
        cx1 = c.x + c.width;
      }

      ax2 = ax1;

      if (a.y < c.y) {
        ax2 = a.x + a.width;
      }

      if (a.y + a.height > c.y + c.height) {
        ax1 = a.x + a.width;
        aw = 0;
      }

      path.setAttribute(
        "d",
        `M ${ax2} ${ay1}
       Q ${cx1} ${ay1}
        ${cx1} ${c.y}
       v ${c.height}
       Q ${cx1} ${ay2}
        ${ax1} ${ay2}
       h ${aw}
       v ${-ah}
       z`
      );
    }

    function makeDraggable(elem, attached) {
      const bb = elem.getBoundingClientRect();

      attached.setAttribute("x", bb.x);
      attached.setAttribute("y", bb.y);
      attached.setAttribute("width", bb.width);
      attached.setAttribute("height", bb.height);

      elem.setAttribute("draggable", "true");
      elem.ondrag = event => {
        elem.setAttribute("x", event.x);
        elem.setAttribute("y", event.y);

        attached.setAttribute("x", event.x);
        attached.setAttribute("y", event.y);
        calc();
      };
    }

    makeDraggable(document.getElementById("a"), anchor);
    makeDraggable(document.getElementById("menu"), content);

    calc();
  </script>
</html>
